<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF--8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カメラとジャイロセンサーのテスト</title>
    <style>
        body { font-family: sans-serif; text-align: center; }
        video {
            width: 45%;
            border: 1px solid black;
            margin: 5px;
        }
        #sensor-data {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            display: inline-block;
        }
        button {
            font-size: 1.2em;
            padding: 10px 20px;
            margin: 20px;
        }
    </style>
</head>
<body>

    <h1>カメラとジャイロセンサー</h1>
    <p>下のボタンを押して、カメラとセンサーの使用を許可してください。</p>

    <button id="start-button">開始</button>

    <div>
        <video id="front-camera" autoplay playsinline></video>
        <video id="back-camera" autoplay playsinline></video>
    </div>

    <div id="sensor-data">
        <h2>ジャイロセンサー情報</h2>
        <p>X軸 (alpha): <span id="alpha">0</span></p>
        <p>Y軸 (beta): <span id="beta">0</span></p>
        <p>Z軸 (gamma): <span id="gamma">0</span></p>
    </div>

    <script>
        const startButton = document.getElementById('start-button');
        const frontVideo = document.getElementById('front-camera');
        const backVideo = document.getElementById('back-camera');

        const alphaSpan = document.getElementById('alpha');
        const betaSpan = document.getElementById('beta');
        const gammaSpan = document.getElementById('gamma');

        startButton.addEventListener('click', async () => {
            // --- カメラの処理 ---
            // 注意: デバイスによっては2つのカメラを同時に有効にできない場合があります。
            // その場合は、どちらか一方のコードをコメントアウトしてお試しください。
            try {
                // インカメラ（自撮り用）
                const frontStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user' }
                });
                frontVideo.srcObject = frontStream;

                // アウトカメラ（背面）
                const backStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                backVideo.srcObject = backStream;

            } catch (err) {
                console.error("カメラの取得に失敗しました: ", err);
                alert("カメラの取得に失敗しました。エラー: " + err.message);
            }

            // --- ジャイロセンサーの処理 ---
            // iOS 13以降では、ユーザーの操作をきっかけに許可を求める必要があります。
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceMotionEvent.requestPermission();
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                    }
                } catch (err) {
                     console.error("モーションセンサーの許可取得に失敗: ", err);
                     alert("モーションセンサーの許可が得られませんでした。");
                }
            } else {
                // Androidなど、許可が不要なデバイスの場合
                window.addEventListener('deviceorientation', handleOrientation);
            }

            startButton.style.display = 'none'; // 開始ボタンを隠す
        });

        function handleOrientation(event) {
            // toFixed(2)で小数点以下2桁に丸めています
            alphaSpan.textContent = event.alpha.toFixed(2);
            betaSpan.textContent = event.beta.toFixed(2);
            gammaSpan.textContent = event.gamma.toFixed(2);
        }
    </script>

</body>
</html>
